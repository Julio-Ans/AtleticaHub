<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cadastro - AtléticaHub</title>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
</head>
<body>
  <h1>Cadastro</h1>
  
  <form id="registerForm">
    <label>Email:<br>
      <input type="email" id="email" required />
    </label><br><br>

    <label>Senha:<br>
      <input type="password" id="password" required />
    </label><br><br>

    <label>Nome completo:<br>
      <input type="text" id="nome" required />
    </label><br><br>

    <label>Data de nascimento:<br>
      <input type="date" id="dataNascimento" required />
    </label><br><br>

    <label>Telefone:<br>
      <input type="text" id="telefone" required />
    </label><br><br>

    <label>Curso:<br>
      <input type="text" id="curso" required />
    </label><br><br>

    <label>Código de convite (opcional):<br>
      <input type="text" id="codigo" />
    </label><br><br>

    <button type="submit">Cadastrar</button>
  </form>

  <pre id="resposta"></pre>

  <script>
    async function main() {
      const resp = await fetch('/config/firebase');
      const cfg = await resp.json();
      firebase.initializeApp(cfg);
      const auth = firebase.auth();

      document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const nome = document.getElementById('nome').value;
        const dataNascimento = document.getElementById('dataNascimento').value;
        const telefone = document.getElementById('telefone').value;
        const curso = document.getElementById('curso').value;
        const codigo = document.getElementById('codigo').value;

        try {
          // Registrar no Firebase
          const cred = await auth.createUserWithEmailAndPassword(email, password);
          const uid = cred.user.uid;

          // Enviar dados para o backend (salvar no PostgreSQL)
          const res = await fetch('/auth/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ uid, email, nome, telefone, curso, dataNascimento, codigo, password })
          });

          const data = await res.json();
          if (!res.ok) throw new Error(data.error);
          
          // Sucesso no cadastro
          document.getElementById('resposta').textContent = '✅ Cadastro concluído!';
          // Sucesso no cadastro
if (data.role === 'admin') {
  window.location.href = '/admin-dashboard';
} else {
  window.location.href = '/user-dashboard';
}

        } catch (err) {
          document.getElementById('resposta').textContent = '❌ ' + err.message;
        }
      });
    }

    main();
  </script>
</body>
</html>
